# ğŸ• QuickBite Food Delivery Platform

## ğŸ“Š Entity Relationship Diagram (ERD)

### ğŸ‘¥ **Users Service**
```
users
â”œâ”€â”€ id (UUID, PK)
â”œâ”€â”€ email (string, unique)
â”œâ”€â”€ password_hash (string)
â”œâ”€â”€ phone (string)
â”œâ”€â”€ full_name (string)
â”œâ”€â”€ role (enum: customer, driver, restaurant_owner, admin)
â”œâ”€â”€ status (enum: active, suspended, inactive)
â”œâ”€â”€ address (string)
â”œâ”€â”€ city (string)
â”œâ”€â”€ stripe_account_id (string)
â”œâ”€â”€ stripe_onboarding_completed (boolean)
â”œâ”€â”€ stripe_created_at (timestamp)
â”œâ”€â”€ created_at (timestamp)
â”œâ”€â”€ updated_at (timestamp)

user_session
â”œâ”€â”€ id (UUID, PK)
â”œâ”€â”€ user_id (UUID, FK â†’ users.id)
â”œâ”€â”€ device_hash (string)
â”œâ”€â”€ expires_at (timestamp)
â”œâ”€â”€ created_at (timestamp)
```

### ğŸª **Restaurant Service**
```
restaurants
â”œâ”€â”€ id (UUID, PK)
â”œâ”€â”€ owner_id (UUID, FK â†’ users.id)
â”œâ”€â”€ name (string)
â”œâ”€â”€ description (text)
â”œâ”€â”€ cuisine_type (string)
â”œâ”€â”€ address (text)
â”œâ”€â”€ city (string)
â”œâ”€â”€ latitude (decimal)
â”œâ”€â”€ longitude (decimal)
â”œâ”€â”€ phone (string)
â”œâ”€â”€ email (string, unique)
â”œâ”€â”€ rating (decimal, default: 0)
â”œâ”€â”€ total_reviews (integer, default: 0)
â”œâ”€â”€ is_active (boolean, default: true)
â”œâ”€â”€ is_verified (boolean, default: false)
â”œâ”€â”€ delivery_fee (decimal)
â”œâ”€â”€ minimum_order (decimal)
â”œâ”€â”€ estimated_prep_time (integer, minutes)
â”œâ”€â”€ is_open(boolean)
â”œâ”€â”€ created_at (timestamp)
â”œâ”€â”€ updated_at (timestamp)

menu_categories
â”œâ”€â”€ id (UUID, PK)
â”œâ”€â”€ restaurant_id (UUID, FK â†’ restaurants.id)
â”œâ”€â”€ name (string)
â”œâ”€â”€ description (text)
â”œâ”€â”€ sort_order (integer)
â”œâ”€â”€ is_active (boolean)

menu_items
â”œâ”€â”€ id (UUID, PK)
â”œâ”€â”€ restaurant_id (UUID, FK â†’ restaurants.id)
â”œâ”€â”€ category_id (UUID, FK â†’ menu_categories.id)
â”œâ”€â”€ name (string)
â”œâ”€â”€ description (text)
â”œâ”€â”€ price (decimal)
â”œâ”€â”€ is_available (boolean, default: true)
â”œâ”€â”€ preparation_time (integer, minutes)
â”œâ”€â”€ created_at (timestamp)
â”œâ”€â”€ updated_at (timestamp)

```

### ğŸ›’ **Order Service**
```
orders
â”œâ”€â”€ id (UUID, PK)
â”œâ”€â”€ customer_id (UUID, FK â†’ users.id)
â”œâ”€â”€ restaurant_id (UUID, FK â†’ restaurants.id)
â”œâ”€â”€ driver_id (UUID, FK â†’ users.id, nullable)
â”œâ”€â”€ order_number (string, unique)
â”œâ”€â”€ status (enum: pending, confirmed, preparing, ready, picked_up, delivered, cancelled, refunded)
â”œâ”€â”€ subtotal (decimal)
â”œâ”€â”€ delivery_fee (decimal)
â”œâ”€â”€ total_amount (decimal)
â”œâ”€â”€ payment_status (enum: pending, paid, refunded, failed)
â”œâ”€â”€ delivery_address (text)
â”œâ”€â”€ estimated_delivery_time (timestamp)
â”œâ”€â”€ actual_delivery_time (timestamp, nullable)
â”œâ”€â”€ created_at (timestamp)
â”œâ”€â”€ updated_at (timestamp)

order_items
â”œâ”€â”€ id (UUID, PK)
â”œâ”€â”€ order_id (UUID, FK â†’ orders.id)
â”œâ”€â”€ menu_item_id (UUID, FK â†’ menu_items.id)
â”œâ”€â”€ menu_item_name (string, FK â†’ menu_items.name)
â”œâ”€â”€ quantity (integer)
â”œâ”€â”€ unit_price (decimal)
â”œâ”€â”€ total_price (decimal)
â”œâ”€â”€ created_at (timestamp)

order_status_history
â”œâ”€â”€ id (UUID, PK)
â”œâ”€â”€ order_id (UUID, FK â†’ orders.id)
â”œâ”€â”€ status (string)
â”œâ”€â”€ changed_at (timestamp)
â”œâ”€â”€ notes (text)
```

### ğŸ’³ **Payment Service**
```
payments
â”œâ”€â”€ id (UUID, PK)
â”œâ”€â”€ order_id (UUID, FK â†’ orders.id)
â”œâ”€â”€ user_id (UUID, FK â†’ users.id)
â”œâ”€â”€ stripe_payment_intent_id (string, unique)
â”œâ”€â”€ amount (decimal)
â”œâ”€â”€ currency (string, default: 'USD')
â”œâ”€â”€ payment_method (enum: card, wallet, cash)
â”œâ”€â”€ status (enum: pending, processing, succeeded, failed, cancelled)
â”œâ”€â”€ fees (decimal, default: 0)
â”œâ”€â”€ metadata (text)
â”œâ”€â”€ created_at (timestamp)
â”œâ”€â”€ updated_at (timestamp)

refunds
â”œâ”€â”€ id (UUID, PK)
â”œâ”€â”€ payment_id (UUID, FK â†’ payments.id)
â”œâ”€â”€ order_id (UUID, FK â†’ orders.id)
â”œâ”€â”€ stripe_refund_id (string, unique)
â”œâ”€â”€ amount (decimal)
â”œâ”€â”€ reason (enum: customer_request, restaurant_cancelled, driver_unavailable, food_quality, other)
â”œâ”€â”€ description (text)
â”œâ”€â”€ status (enum: pending, processing, succeeded, failed)
â”œâ”€â”€ requested_by (UUID, FK â†’ users.id)
â”œâ”€â”€ processed_by (UUID, FK â†’ users.id, nullable)
â”œâ”€â”€ requested_at (timestamp)
â”œâ”€â”€ processed_at (timestamp, nullable)

driver_earnings
â”œâ”€â”€ id (UUID, PK)
â”œâ”€â”€ driver_id (UUID, FK â†’ users.id)
â”œâ”€â”€ order_id (UUID, FK â†’ orders.id)
â”œâ”€â”€ base_earning (decimal)
â”œâ”€â”€ tip_amount (decimal, default: 0)
â”œâ”€â”€ bonus_amount (decimal, default: 0)
â”œâ”€â”€ total_earning (decimal)
â”œâ”€â”€ payout_status (enum: pending, processing, paid)
â”œâ”€â”€ payout_date (timestamp, nullable)
â”œâ”€â”€ created_at (timestamp)

restaurant_settlements
â”œâ”€â”€ id (UUID, PK)
â”œâ”€â”€ restaurant_id (UUID, FK â†’ restaurants.id)
â”œâ”€â”€ order_id (UUID, FK â†’ orders.id)
â”œâ”€â”€ gross_amount (decimal)
â”œâ”€â”€ commission_rate (decimal)
â”œâ”€â”€ commission_amount (decimal)
â”œâ”€â”€ net_amount (decimal)
â”œâ”€â”€ settlement_status (enum: pending, processing, paid)
â”œâ”€â”€ settlement_date (timestamp, nullable)
â”œâ”€â”€ created_at (timestamp)
```

### ğŸšš **Delivery Service**
```
delivery_assignments
â”œâ”€â”€ id (UUID, PK)
â”œâ”€â”€ order_id (UUID, FK â†’ orders.id)
â”œâ”€â”€ driver_id (UUID, FK â†’ users.id)
â”œâ”€â”€ assigned_at (timestamp)
â”œâ”€â”€ accepted_at (timestamp, nullable)
â”œâ”€â”€ picked_up_at (timestamp, nullable)
â”œâ”€â”€ delivered_at (timestamp, nullable)
â”œâ”€â”€ status (enum: assigned, accepted, en_route_to_restaurant, arrived_at_restaurant, picked_up, en_route_to_customer, delivered, cancelled)

delivery_tracking
â”œâ”€â”€ id (UUID, PK)
â”œâ”€â”€ delivery_id (UUID, FK â†’ delivery_assignments.id)
â”œâ”€â”€ latitude (decimal)
â”œâ”€â”€ longitude (decimal)
â”œâ”€â”€ timestamp (timestamp)
â”œâ”€â”€ speed (decimal, nullable)
â”œâ”€â”€ heading (decimal, nullable)

driver_locations
â”œâ”€â”€ driver_id (UUID, FK â†’ users.id, PK)
â”œâ”€â”€ latitude (decimal)
â”œâ”€â”€ longitude (decimal)
â”œâ”€â”€ is_online (boolean, default: false)
â”œâ”€â”€ last_updated (timestamp)
```

### â­ **Review Service**
```
reviews
â”œâ”€â”€ id (UUID, PK)
â”œâ”€â”€ order_id (UUID, FK â†’ orders.id)
â”œâ”€â”€ customer_id (UUID, FK â†’ users.id)
â”œâ”€â”€ restaurant_id (UUID, FK â†’ restaurants.id)
â”œâ”€â”€ driver_id (UUID, FK â†’ users.id, nullable)
â”œâ”€â”€ restaurant_rating (integer, 1-5)
â”œâ”€â”€ driver_rating (integer, 1-5, nullable)
â”œâ”€â”€ food_quality (integer, 1-5)
â”œâ”€â”€ delivery_time (integer, 1-5)
â”œâ”€â”€ restaurant_comment (text)
â”œâ”€â”€ driver_comment (text, nullable)
â”œâ”€â”€ is_verified (Boolean, {default: true})
â”œâ”€â”€ is_visible (Boolean, {default: true})
â”œâ”€â”€ created_at (timestamp)
â”œâ”€â”€ updated_at (timestamp)

review_responses
â”œâ”€â”€ id (UUID, PK)
â”œâ”€â”€ review_id (UUID, FK â†’ reviews.id)
â”œâ”€â”€ responder_id (UUID, FK â†’ users.id)
â”œâ”€â”€ responder_type (enum: restaurant, admin)
â”œâ”€â”€ response (text)
â”œâ”€â”€ created_at (timestamp)

review_helful
â”œâ”€â”€ id (UUID, PK)
â”œâ”€â”€ review_id (UUID, FK â†’ reviews.id)
â”œâ”€â”€ user_id (UUID, FK â†’ users.id)
â”œâ”€â”€ is_helpful (boolean)
â”œâ”€â”€ created_at (timestamp)
â”œâ”€â”€ updated_at (timestamp)

review_reports
â”œâ”€â”€ id (UUID, PK)
â”œâ”€â”€ review_id (UUID, FK â†’ reviews.id)
â”œâ”€â”€ reporter_id (UUID, FK â†’ users.id)
â”œâ”€â”€ reason (enum: spam, inappropriate, fake, offensive, other)
â”œâ”€â”€ description (text)
â”œâ”€â”€ status (enum: pending, reviewed, resolved, rejected, {default: pending})
â”œâ”€â”€ reviewed_by (UUID â†’ users.id (admin))
â”œâ”€â”€ created_at (timestamp)
â”œâ”€â”€ updated_at (timestamp)
```

### ğŸ“§ **Notification Service**
```
notification_templates
â”œâ”€â”€ id (UUID, PK)
â”œâ”€â”€ template_key (string, unique)
â”œâ”€â”€ template_type (enum: email, sms, push)
â”œâ”€â”€ subject (string, nullable)
â”œâ”€â”€ content (text)
â”œâ”€â”€ variables (JSON)
â”œâ”€â”€ is_active (boolean, default: true)
â”œâ”€â”€ created_at (timestamp)
â”œâ”€â”€ updated_at (timestamp)

notification_queue
â”œâ”€â”€ id (UUID, PK)
â”œâ”€â”€ user_id (UUID, FK â†’ users.id)
â”œâ”€â”€ template_key (string)
â”œâ”€â”€ notification_type (enum: email, sms, push)
â”œâ”€â”€ recipient (string)
â”œâ”€â”€ subject (string, nullable)
â”œâ”€â”€ content (text)
â”œâ”€â”€ variables (JSON)
â”œâ”€â”€ status (enum: pending, processing, sent, failed, retry)
â”œâ”€â”€ scheduled_at (timestamp)
â”œâ”€â”€ sent_at (timestamp, nullable)
â”œâ”€â”€ retry_count (integer, default: 0)
â”œâ”€â”€ error_message (text, nullable)
â”œâ”€â”€ created_at (timestamp)
â”œâ”€â”€ updated_at (timestamp)

notification_logs
â”œâ”€â”€ id (UUID, PK)
â”œâ”€â”€ queue_id (UUID, FK â†’ notification_queue.id)
â”œâ”€â”€ status (string)
â”œâ”€â”€ response (JSON)
â”œâ”€â”€ timestamp (timestamp)
```

## ğŸ—ï¸ **Microservice Architecture**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API Gateway (Port 3000)                      â”‚
â”‚                     Load Balancer & Routing                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                  â”‚                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ User Service   â”‚  â”‚Restaurant Svc  â”‚  â”‚ Order Service â”‚
        â”‚   (3001)      â”‚  â”‚    (3002)     â”‚  â”‚    (3003)     â”‚
        â”‚   Auth & Profileâ”‚  â”‚Menu & Hours   â”‚  â”‚ Cart & Orders â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                  â”‚                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
        â”‚Payment Service â”‚  â”‚Delivery Svc   â”‚  â”‚Review Service â”‚
        â”‚   (3004)      â”‚  â”‚    (3005)     â”‚  â”‚    (3006)     â”‚
        â”‚Stripe & Refundsâ”‚  â”‚Driver & Track â”‚  â”‚Rating & Reviewsâ”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                  
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â” 
        â”‚Notification        â”‚ 
        â”‚Service (3007)      â”‚ 
        â”‚Email & RabbitMQ    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Shared Infrastructure                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ PostgreSQL  â”‚ â”‚  RabbitMQ   â”‚ â”‚    Redis    â”‚ â”‚   Stripe   â”‚ â”‚
â”‚  â”‚  Database   â”‚ â”‚   Queue     â”‚ â”‚   Cache     â”‚ â”‚  Payments  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ **Key API Flows**

### ğŸ“± **Order Creation Flow:**
1. `POST /api/orders` â†’ Order Service
2. Order Service â†’ Restaurant Service (validate menu)
3. Order Service â†’ Payment Service (create payment intent)
4. Payment Service â†’ Stripe API
5. Order Service â†’ Notification Service (RabbitMQ)
6. Notification Service â†’ Email confirmation

### ğŸ’¸ **Refund Process Flow:**
1. `POST /api/refunds` â†’ Payment Service
2. Payment Service â†’ Stripe (create refund)
3. Payment Service â†’ Order Service (update status)
4. Payment Service â†’ Notification Service (refund notification)
5. Payment Service â†’ Analytics (refund metrics)

### ğŸšš **Delivery Tracking Flow:**
1. Driver accepts order â†’ Delivery Service
2. Real-time location updates â†’ Delivery Service
3. Status updates â†’ Order Service
4. Customer notifications â†’ Notification Service
5. Delivery completion â†’ Payment Service (driver earnings)

## ğŸ’³ **Payment Integration Scenarios**

### ğŸ¯ **Stripe Integration Points:**
- **Order Payments** with tips
- **Subscription Billing** for premium features
- **Refund Processing** (partial/full)
- **Driver Payouts** via Stripe Connect
- **Restaurant Settlements** with commission deduction
- **Failed Payment Retry** logic

### ğŸ”„ **Refund Types:**
- **Customer Initiated** - Quality issues, wrong order
- **Restaurant Cancelled** - Out of stock, closing early  
- **Driver Unavailable** - No driver found
- **System Error** - Technical failures
- **Partial Refunds** - Missing items

## ğŸ“§ **Email Notification Workflows**

### ğŸ“¬ **RabbitMQ Queue Structure:**
```
email.order.confirmation    â†’ Order placed successfully
email.order.cancelled      â†’ Order cancellation
email.payment.received     â†’ Payment confirmation
email.refund.processed     â†’ Refund completion
email.delivery.updates     â†’ Delivery status changes
email.loyalty.rewards      â†’ Points earned/redeemed
email.subscription.billing â†’ Subscription renewals
email.promotional          â†’ Marketing campaigns
```

### âœ‰ï¸ **Email Types:**
- **Transactional** - Orders, payments, refunds
- **Operational** - Delivery updates, restaurant closures
- **Marketing** - Promotions, loyalty rewards
- **Administrative** - Account changes, security alerts

## ğŸ§ª **Testing Strategy**

### ğŸ“Š **Service-Level Tests:**
- **Unit Tests** - Business logic, validations
- **Integration Tests** - Database operations
- **API Tests** - Endpoint functionality
- **Contract Tests** - Inter-service communication

### ğŸ”„ **End-to-End Scenarios:**
- Complete order journey (order â†’ payment â†’ delivery)
- Refund processing workflows
- Driver assignment and tracking
- Email notification delivery
